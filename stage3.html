<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë³´ ë³´ì•ˆ ê²Œì„</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #f7f7f7;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
        }
        #quizModal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 10;
        }
        #quizModal h2 {
            margin-bottom: 15px;
        }
        #quizModal button {
            margin: 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #0099ff;
            color: white;
            cursor: pointer;
        }
        #quizModal button:hover {
            background-color: #00FFFF;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="quizModal">
    <h2 id="quizQuestion">ë°”ì´ëŸ¬ìŠ¤ì™€ ë°±ì‹  í€´ì¦ˆ</h2>
    <p>ì»´í“¨í„°ì— ë°”ì´ëŸ¬ìŠ¤ê°€ í¼ì¡ŒìŠµë‹ˆë‹¤! ì•„ë˜ ì¤‘ ê°€ì¥ ë¨¼ì € í•´ì•¼ í•  ì¼ì€ ë¬´ì—‡ì¼ê¹Œìš”?</p>
    <button onclick="checkAnswer('update')">ë°±ì‹  í”„ë¡œê·¸ë¨ ì—…ë°ì´íŠ¸</button>
    <button onclick="checkAnswer('install')">ë°±ì‹  í”„ë¡œê·¸ë¨ ì„¤ì¹˜</button>
    <button onclick="checkAnswer('scan')">ì»´í“¨í„° ì „ì²´ ê²€ì‚¬</button>
</div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const groundHeight = 50;
        const groundY = canvas.height - groundHeight;

        const player = {
            x: 50,
            y: groundY - 110,
            width: 110,
            height: 110,
            velocityY: 0,
            gravity: 1.2,
            jumpPower: -30,
            isJumping: false,
            image: new Image()
        };

        const obstacles = [];
        const obstacleImage = new Image();
        obstacleImage.src = 'hacker3.png';
        const MIN_OBSTACLE_DISTANCE = 900;

        const locks = [];
        const lockImage = new Image();
        lockImage.src = 'lock.png';

        const quizData = {
            question: "íŒŒì¼ì„ ë³´í˜¸í•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€?",
            options: ["ì•”í˜¸í™”", "ê³µìœ ", "USB ì €ì¥"],
            answer: "ì•”í˜¸í™”"
        };

        const background = new Image();
        background.src = 'background3.png';
        let bgX1 = 0;
        let bgX2 = canvas.width;

        let isGameOver = false;
        let isGameRunning = false;
        let collectedLocks = 0;
        let isObstacleLockActive = false; // ì¥ì• ë¬¼ ìœ„ ìë¬¼ì‡  ìƒíƒœ


        const MAX_LOCKS = 25;
        const MIN_LOCK_DISTANCE = 400; // ìë¬¼ì‡  ê°„ ìµœì†Œ ê±°ë¦¬
        const MIN_LOCK_OBSTACLE_DISTANCE = 200; // ìë¬¼ì‡ ì™€ ì¥ì• ë¬¼ ê°„ ìµœì†Œ ê±°ë¦¬

        const progressBar = {
            x: 20,
            y: 20,
            width: 300,
            height: 20
        };

        player.image.src = 'guard.png';

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw background
            ctx.drawImage(background, bgX1, 0, canvas.width, canvas.height);
            ctx.drawImage(background, bgX2, 0, canvas.width, canvas.height);

            // Draw ground
            ctx.fillStyle = "#EE82EE";
            ctx.fillRect(0, groundY, canvas.width, groundHeight);

            // Draw player
            ctx.drawImage(player.image, player.x, player.y, player.width, player.height);

            // Draw obstacles
            obstacles.forEach(obstacle => {
                ctx.drawImage(obstacleImage, obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            });

            // Draw locks
            locks.forEach(lock => {
                ctx.drawImage(lockImage, lock.x, lock.y, lock.width, lock.height);
            });

            // Draw progress bar
            drawProgressBar();
        }

        function drawProgressBar() {
            ctx.fillStyle = 'grey';
            ctx.fillRect(progressBar.x, progressBar.y, progressBar.width, progressBar.height);

            const progressWidth = (collectedLocks / MAX_LOCKS) * progressBar.width;
            ctx.fillStyle = 'green';
            ctx.fillRect(progressBar.x, progressBar.y, progressWidth, progressBar.height);

            ctx.strokeStyle = 'white';
            ctx.strokeRect(progressBar.x, progressBar.y, progressBar.width, progressBar.height);
        }

        function updateBackground() {
            bgX1 -= 10;
            bgX2 -= 10;

            if (bgX1 + canvas.width <= 0) {
                bgX1 = canvas.width;
            }

            if (bgX2 + canvas.width <= 0) {
                bgX2 = canvas.width;
            }
        }

        function spawnObstacle() {
            if (obstacles.length < 3) {
                const lastObstacle = obstacles[obstacles.length - 1];
                const obstacleX = lastObstacle ? Math.max(lastObstacle.x + MIN_OBSTACLE_DISTANCE, canvas.width) : canvas.width;
                obstacles.push({
                    x: obstacleX,
                    y: groundY - 230,
                    width: 180,
                    height: 230
                });
            }
        }

        function spawnLock() {
            spawnLockOnObstacle(); // ì¥ì• ë¬¼ ìœ„ ìë¬¼ì‡  ìƒì„± ì‹œë„
            spawnLockOnGround();   // ë°”ë‹¥ ìë¬¼ì‡  ìƒì„±
        }

        function spawnLockOnGround() {
            if (locks.length < 5) {
                let lockX, lockY = groundY - 70;
                let isPositionValid = false;
                let attempts = 0;
                const maxAttempts = 10;

                do {
                    lockX = canvas.width + Math.random() * 500;

                    // ìë¬¼ì‡  ê°„ ê±°ë¦¬ í™•ì¸
                    const tooCloseToOtherLocks = locks.some(
                        lock => Math.abs(lockX - lock.x) < MIN_LOCK_DISTANCE
                    );

                    // ì¥ì• ë¬¼ê³¼ ê±°ë¦¬ í™•ì¸
                    const tooCloseToObstacles = obstacles.some(
                        obstacle => Math.abs(lockX - obstacle.x) < MIN_LOCK_OBSTACLE_DISTANCE
                    );

                    // ìœ„ì¹˜ê°€ ìœ íš¨í•œì§€ í™•ì¸
                    isPositionValid = !tooCloseToOtherLocks && !tooCloseToObstacles;
                    attempts++;
                } while (!isPositionValid && attempts < maxAttempts);

                // ìœ„ì¹˜ê°€ ìœ íš¨í•˜ë‹¤ë©´ ìë¬¼ì‡  ì¶”ê°€
                if (isPositionValid) {
                    locks.push({
                        x: lockX,
                        y: lockY,
                        width: 70,
                        height: 70
                    });
                }
            }
        }

        function spawnLockOnObstacle() {
            obstacles.forEach(obstacle => {
                if (!obstacle.hasLock && Math.random() < 0.5) { // ìë¬¼ì‡ ê°€ ì—†ëŠ” ì¥ì• ë¬¼ì—ë§Œ ìƒì„±
                    const lockX = obstacle.x + obstacle.width / 2 - 35;
                    const lockY = obstacle.y - 250;

                    // ê¸°ì¡´ ìë¬¼ì‡ ì™€ ì¤‘ë³µ ì—¬ë¶€ í™•ì¸
                    const isPositionValid = !locks.some(lock =>
                        Math.abs(lock.x - lockX) < 1 && Math.abs(lock.y - lockY) < 1
                    );

                    if (isPositionValid) {
                        locks.push({ x: lockX, y: lockY, width: 70, height: 70 });
                        obstacle.hasLock = true; // ìë¬¼ì‡  ìƒì„± í›„ í”Œë˜ê·¸ ì„¤ì •
                    }
                }
            });
        }






        function updateLocks() {
            locks.forEach((lock, index) => {
                lock.x -= 16;

                // í”Œë ˆì´ì–´ê°€ ìë¬¼ì‡ ë¥¼ ë¨¹ì—ˆëŠ”ì§€ í™•ì¸
                if (
                    player.x < lock.x + lock.width &&
                    player.x + player.width > lock.x &&
                    player.y < lock.y + lock.height &&
                    player.y + player.height > lock.y
                ) {
                    locks.splice(index, 1); // ìë¬¼ì‡  ì œê±°
                    collectedLocks += 1; // ìë¬¼ì‡  ê°œìˆ˜ ì¦ê°€

                    // MAX_LOCKSë¥¼ ëª¨ë‘ ëª¨ì•˜ì„ ë•Œë§Œ í€´ì¦ˆë¥¼ ë„ì›€
                    if (collectedLocks >= MAX_LOCKS) {
                        alert('ìë¬¼ì‡ ë¥¼ ë‹¤ ëª¨ì•˜ìŠµë‹ˆë‹¤. ğŸ‰ğŸŠ í€´ì¦ˆë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤!');
                        showQuiz();
                    }

                    // ì¥ì• ë¬¼ ìœ„ ìë¬¼ì‡  ì œê±° ì‹œ í”Œë˜ê·¸ í•´ì œ
                    isObstacleLockActive = false;
                }

                // ìë¬¼ì‡ ê°€ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±°
                if (lock.x + lock.width < 0) {
                    locks.splice(index, 1);

                    // ì¥ì• ë¬¼ ìœ„ ìë¬¼ì‡ ê°€ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ í”Œë˜ê·¸ í•´ì œ
                    isObstacleLockActive = false;
                }
            });
        }






        function updateObstacles() {
            obstacles.forEach((obstacle, index) => {
                obstacle.x -= 16;

                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(index, 1);
                }

                if (
                    player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y < obstacle.y + obstacle.height &&
                    player.y + player.height > obstacle.y
                ) {
                    isGameOver = true;
                    alert('ê²Œì„ ì¢…ë£Œ!');
                    resetGame();
                }
            });
        }

        function update() {
            if (isGameOver) return;

            player.velocityY += player.gravity;
            player.y += player.velocityY;

            if (player.y > groundY - player.height) {
                player.y = groundY - player.height;
                player.velocityY = 0;
                player.isJumping = false;
            }

            updateBackground();
            updateObstacles();
            updateLocks();
            spawnObstacle();
            spawnLock();
        }

        function showQuiz() {
            isGameRunning = false;
            const quizModal = document.getElementById('quizModal');
            const quizQuestion = document.getElementById('quizQuestion');
            const quizOptions = document.getElementById('quizOptions');

            quizQuestion.textContent = quizData.question;
            quizOptions.innerHTML = '';

            quizData.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.addEventListener('click', () => checkAnswer(option));
                quizOptions.appendChild(button);
            });

            quizModal.style.display = 'block';
        }

        function checkAnswer(selectedOption) {
            if (selectedOption === quizData.answer) {
                alert('ì •ë‹µ! ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = 'stage2.html';
            } else {
                alert('ì˜¤ë‹µì…ë‹ˆë‹¤! ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
            }

            document.getElementById('quizModal').style.display = 'none';
            isGameRunning = true;
            gameLoop();
        }

        function resetGame() {
            isGameOver = false;
            collectedLocks = 0;
            locks.length = 0;
            obstacles.length = 0;
            player.y = groundY - player.height;
            player.velocityY = 0;
            startGame();
        }

        function startGame() {
            if (isGameRunning) return;
            isGameRunning = true;
            gameLoop();
        }

        function gameLoop() {
            if (!isGameRunning) return;

            update();
            render();

            if (!isGameOver) {
                requestAnimationFrame(gameLoop);
            }
        }

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !player.isJumping) {
                player.velocityY = player.jumpPower;
                player.isJumping = true;
            }
        });

        // ë§ˆìš°ìŠ¤ í´ë¦­ìœ¼ë¡œ ì í”„
        canvas.addEventListener('mousedown', () => {
            if (!player.isJumping) {
                player.velocityY = player.jumpPower;
                player.isJumping = true;
            }
        });

        // í„°ì¹˜ë¡œ ì í”„ (ëª¨ë°”ì¼ ëŒ€ì‘)
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // í„°ì¹˜ ê¸°ë³¸ ë™ì‘ ë°©ì§€
            if (!player.isJumping) {
                player.velocityY = player.jumpPower;
                player.isJumping = true;
            }
        });

        startGame();
    </script>
</body>
</html>


<div id="quizModal">
    <h2 id="quizQuestion">ë°”ì´ëŸ¬ìŠ¤ì™€ ë°±ì‹  í€´ì¦ˆ</h2>
    <p>ì»´í“¨í„°ì— ë°”ì´ëŸ¬ìŠ¤ê°€ í¼ì¡ŒìŠµë‹ˆë‹¤! ì•„ë˜ ì¤‘ ê°€ì¥ ë¨¼ì € í•´ì•¼ í•  ì¼ì€ ë¬´ì—‡ì¼ê¹Œìš”?</p>
    <button onclick="checkAnswer('update')">ë°±ì‹  í”„ë¡œê·¸ë¨ ì—…ë°ì´íŠ¸</button>
    <button onclick="checkAnswer('install')">ë°±ì‹  í”„ë¡œê·¸ë¨ ì„¤ì¹˜</button>
    <button onclick="checkAnswer('scan')">ì»´í“¨í„° ì „ì²´ ê²€ì‚¬</button>
</div>

<script>
    function showQuiz() {
    isGameRunning = false;
    window.location.href = 'game_quiz3.html'; // ìƒˆë¡œìš´ HTML í˜ì´ì§€ë¡œ ì´ë™
}

    function checkAnswer(selectedOption) {
        const quizModal = document.getElementById('quizModal');
        if (selectedOption === 'update') {
            alert('ì •ë‹µì…ë‹ˆë‹¤! ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
            window.location.href = 'stage2.html';
        } else {
            alert('ì˜¤ë‹µì…ë‹ˆë‹¤! ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
        }
        quizModal.style.display = 'none';
        isGameRunning = true;
        gameLoop();
    }
</script>
